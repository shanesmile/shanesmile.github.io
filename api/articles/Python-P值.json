{"title":"Python_P值","slug":"Python-P值","date":"2019-10-11T09:30:10.000Z","updated":"2019-10-11T09:33:17.929Z","comments":true,"path":"api/articles/Python-P值.json","photos":[],"link":"","excerpt":"2013年10月8日，因为提出的“次原子粒子质量的生成机制理论，促进了人类对这方面的理解，并且上帝粒子（The God Particle）—希格斯玻色子（Higgs boson）由欧洲核子研究组织下属大型强子对撞机的超环面仪器（5.9个标准差）及紧凑μ子线圈探测器（5.8个标准差）发现的基本粒子证实”，2013年的诺贝尔物理学奖颁发给了弗朗索瓦·恩格勒和彼得·希格斯。","covers":null,"content":"<blockquote>\n<p>2013年10月8日，因为提出的“次原子粒子质量的生成机制理论，促进了人类对这方面的理解，并且上帝粒子（The God Particle）—希格斯玻色子（Higgs boson）由欧洲核子研究组织下属大型强子对撞机的超环面仪器（5.9个标准差）及紧凑μ子线圈探测器（5.8个标准差）发现的基本粒子证实”，2013年的诺贝尔物理学奖颁发给了弗朗索瓦·恩格勒和彼得·希格斯。</p>\n</blockquote>\n<a id=\"more\"></a>\n<p>欧洲核子研究组织认为要超过「5-sigma」阈值（这意味着 p 值为 0.0000003）才能确认发现了希格斯玻色子。局部统计显著性5个标准差──错误概率低于百万分之一。</p>\n<p>So，什么是 p 值，如何在假设检验中使用 p 值？</p>\n<p>首先看下维基百科的定义：</p>\n<blockquote>\n<p>In statistical hypothesis testing, the p-value or probability value is, for a given statistical model, the probability that, when the null hypothesis is true, the statistical summary (such as the absolute value of the sample mean difference between two compared groups) would be greater than or equal to the actual observed results.</p>\n</blockquote>\n<p>上述概念似乎抽象难懂，本节课尝试通过一个假设检验案例，给出p值及显著性的相对直观的解释</p>\n<p>从以下四个连续的部分进行介绍：</p>\n<p>假设检验（Hypothesis Testing）</p>\n<p>正太分布（Normal Distribution）</p>\n<p>p值（What is P-value?）</p>\n<p>统计显著性（Statistical Significance）</p>\n<h1 id=\"1-假设检验\"><a href=\"#1-假设检验\" class=\"headerlink\" title=\"1. 假设检验\"></a>1. 假设检验</h1><p>image.png</p>\n<p>假设检验是使用一组样本数据验证对于总体的一个声明（零假设，null hypothesis）是否正确（有效）。备选假设(alternative hypothesis)是零假设被证明无效时的选项。 为了判断假设有效与否，使用p值判定实验数据的说服力判断假设是否在统计意义上是显著的。如果数据支持备选假设，则拒绝零假设，接受备选假设。</p>\n<p>案例： 一家外卖店声称配送时间在30分钟以内，直觉上觉得配送时间是超出30分钟的。于是，我们设计了一个假设检验，随机采样一组配送时间验证我们的假设。</p>\n<p>零假设：平均配送时间不超过30分钟</p>\n<p>备选假设：平均配送时间超过30分钟</p>\n<p>鉴于我们仅关心平均配送时间是否超过30分钟，所以，使用单侧检验方法Z-test。常用的检验方法有T-test，F-test，𝜒2-test。</p>\n<h1 id=\"2-正态分布\"><a href=\"#2-正态分布\" class=\"headerlink\" title=\"2. 正态分布\"></a>2. 正态分布</h1><p>image.png</p>\n<p>上图是正态分布的概率密度函数，均值𝜇，标准差𝜎。</p>\n<p>正态分布常与68-95-99.7规则联系起来：</p>\n<p>68%的样本分布于均值相距一个标准差的范围内</p>\n<p>95%的样本分布于与均值相距两个标准差的数据</p>\n<p>99.7%的样本分布于与均值相距三个标准差的数据</p>\n<p>前文提到的证明希格斯玻色子存在的5𝜎阈值表示排除了99.9999426696856%的干扰信号。</p>\n<p>那么，正态分布与假设检验的联系是什么呢？ 对于采样得到的配送时间样本𝑥，其均值是𝜇，标准差是𝜎。可以计算每个样本数据的z-score，</p>\n<p>𝑧=𝑥−𝜇𝜎<br>得到每个配送时间样本的z-score之后，我们画出如下图的标准正态分布，x轴的单位从配送时间分钟变成了标准差的个数，</p>\n<p>image.png</p>\n<p>查看上图的标准正态分布曲线是非常有意义的，因为我们将假设检验的结果与标准差单位化的总体的正态分布进行比较。</p>\n<p>Z-score告诉我们所有样本数据相对于总体平均值的分布趋势。</p>\n<p>越高的或者越低的Z-score，表明统计结果越不是因为偶然因素出现，也意味着统计结果有更大的意义。</p>\n<p>下一个问题，多高或者多低的值才有足够说服力证明统计结果的意义？</p>\n<p>终于轮到p-value登场了。</p>\n<p>根据预先设定的显著性水平(significance level, 𝛼)，我们可以检验分析结果的统计显著性。</p>\n<h1 id=\"3-p-value\"><a href=\"#3-p-value\" class=\"headerlink\" title=\"3. p-value\"></a>3. p-value</h1><p>基于前文的案例和阐述，我们接近于揭开p-value的什么面纱，理解p-value如何帮助我们对于假设检验做出决策。</p>\n<p>在外卖配送案例中，我们随机采样了一组配送时间，目标是检查平均配送时间是否超过30分钟。如果统计证据支持平均配送时间不超过30分钟，我们接受零假设，否则，拒绝零假设。</p>\n<p>p-value在外卖配送场景是用来回答以下问题，</p>\n<p>如果我们生活在外卖配送时间少于30分钟的世界里，在现实生活中我们的统计观察证据有多出乎意料？</p>\n<p>p-value使用概率数值回答上述问题。</p>\n<p>p-value的值越小，统计观察证据越出乎意料，我们的零假设也看起来越荒谬。</p>\n<p>当我们对零假设感到荒谬时，我们拒绝零假设并接受备选假设。</p>\n<p>如果p-value低于预先设定的显著性水平𝛼，我们拒绝零假设。</p>\n<p>现在，把p-value应用到外卖配送案例中。</p>\n<p>通过统计采样得到的配送时间样本，我们发现平均配送时间超时10分钟的p-value是0.03。</p>\n<p>这意味着，在外卖配送时间不超过30分钟的现实世界里（即零假设为真的世界里），有3%的几率看到平均配送时间因为偶然因素至少超时10分钟。</p>\n<p>越低的p-value意味着统计观察结果越有意义，因为观察结果越不可能是因为噪声引起的。</p>\n<p>对于p-value，一个常见的误解是，0.03的p-value意味着3%的可能性观察结果是因为偶然性或随机性因素引发的，这种理解是不对的。</p>\n<p>因为习惯于得到确定的结果，因此对p-value的理解容易产生迷惑。实际上，p-value不能证明什么，它只是使用出乎意料的程度作为做出合理决策的依据。</p>\n<p>对于0.03的p-value，我们可以得出以下合理的决策：</p>\n<p>想象我们生活在外卖平均配送时间总是不超过30分钟的世界（初始信念）。</p>\n<p>在分析完收集的配送时间样本数据后，0.03的p-value低于显著性水平0.05（实验开始时做出的设定），我们可以说实验结果是在统计意义上是显著的。</p>\n<p>因为我们总是相信外卖配送会在30分钟以内完成，我们需要思考这个初始的信念是否有意义，因为观察结果表明外卖配送是超时的，并且结果是统计显著的。</p>\n<p>所以，我们应该做出什么决策。首先，我们努力寻找使得我们的初始信念成立的任何依据。但是，观察到外卖店越来越多的负面评论以及超时配送，我们觉得坚持初始信念是没有意义的，因此，最终拒绝了零假设。</p>\n<p>最终，合理的决策即为不再从该外卖店订外卖。</p>\n<p>从上述分析中，可以发现，p-value不能用来做出任何证明或判断。只是在观察结果统计显著时用来挑战初始假设的工具，进一步拒绝或接受零假设，做出合理的决策。</p>\n<h1 id=\"4-统计显著性\"><a href=\"#4-统计显著性\" class=\"headerlink\" title=\"4. 统计显著性\"></a>4. 统计显著性</h1><p>最后的环节是综合所有统计分析结果，验证实验结果是否是统计显著的。</p>\n<p>只有p-value是不够的，我们需要在实验开始前设置显著性水平𝛼。如果p-value小于𝛼，可以认为观察结果是统计显著的。</p>\n<p>常用的𝛼是0.05，0.01，0.001，可以根据具体的研究问题做选择。在外卖配送场景中，我们使用的𝛼是0.05。</p>\n<p>T-test</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> scipy.stats <span class=\"keyword\">import</span> ttest_1samp</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">ages = np.genfromtxt(<span class=\"string\">\"ages.csv\"</span>)</span><br><span class=\"line\">print(ages)</span><br><span class=\"line\">ages_mean = np.mean(ages)</span><br><span class=\"line\">print(ages_mean)</span><br><span class=\"line\">tset, pval = ttest_1samp(ages, <span class=\"number\">30</span>)</span><br><span class=\"line\">print(<span class=\"string\">\"tset\"</span>,tset)</span><br><span class=\"line\">print(<span class=\"string\">\"p-values\"</span>,pval)</span><br><span class=\"line\"><span class=\"keyword\">if</span> pval &lt; <span class=\"number\">0.05</span>:    <span class=\"comment\"># alpha value is 0.05 or 5%</span></span><br><span class=\"line\">   print(<span class=\"string\">\" we are rejecting null hypothesis\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">  print(<span class=\"string\">\"we are accepting null hypothesis\"</span>)</span><br><span class=\"line\">[<span class=\"number\">32.</span> <span class=\"number\">34.</span> <span class=\"number\">29.</span> <span class=\"number\">29.</span> <span class=\"number\">22.</span> <span class=\"number\">39.</span> <span class=\"number\">38.</span> <span class=\"number\">37.</span> <span class=\"number\">38.</span> <span class=\"number\">36.</span> <span class=\"number\">30.</span> <span class=\"number\">26.</span> <span class=\"number\">22.</span> <span class=\"number\">22.</span>]</span><br><span class=\"line\"><span class=\"number\">31.0</span></span><br><span class=\"line\">tset <span class=\"number\">0.5973799001456603</span></span><br><span class=\"line\">p-values <span class=\"number\">0.5605155888171379</span></span><br><span class=\"line\">we are accepting null hypothesis</span><br><span class=\"line\">week1 = np.random.normal(loc=<span class=\"number\">25</span>,scale=<span class=\"number\">4</span>,size=<span class=\"number\">100</span>)</span><br><span class=\"line\">week2 = np.random.normal(loc=<span class=\"number\">29</span>,scale=<span class=\"number\">5</span>,size=<span class=\"number\">100</span>)</span><br><span class=\"line\"><span class=\"keyword\">from</span> scipy.stats <span class=\"keyword\">import</span> ttest_ind</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">​</span><br><span class=\"line\">week1_mean = np.mean(week1)</span><br><span class=\"line\">week2_mean = np.mean(week2)</span><br><span class=\"line\">print(<span class=\"string\">\"week1 mean value:\"</span>,week1_mean)</span><br><span class=\"line\">print(<span class=\"string\">\"week2 mean value:\"</span>,week2_mean)</span><br><span class=\"line\">week1_std = np.std(week1)</span><br><span class=\"line\">week2_std = np.std(week2)</span><br><span class=\"line\">print(<span class=\"string\">\"week1 std value:\"</span>,week1_std)</span><br><span class=\"line\">print(<span class=\"string\">\"week2 std value:\"</span>,week2_std)</span><br><span class=\"line\">ttest,pval = ttest_ind(week1,week2)</span><br><span class=\"line\">print(<span class=\"string\">\"p-value\"</span>,pval)</span><br><span class=\"line\"><span class=\"keyword\">if</span> pval &lt;<span class=\"number\">0.05</span>:</span><br><span class=\"line\">  print(<span class=\"string\">\"we reject null hypothesis\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">  print(<span class=\"string\">\"we accept null hypothesis\"</span>)</span><br><span class=\"line\">week1 mean value: <span class=\"number\">24.885051289542336</span></span><br><span class=\"line\">week2 mean value: <span class=\"number\">29.116993276608923</span></span><br><span class=\"line\">week1 std value: <span class=\"number\">4.117439847689013</span></span><br><span class=\"line\">week2 std value: <span class=\"number\">5.277647183914421</span></span><br><span class=\"line\">p-value <span class=\"number\">1.9880506604675494e-09</span></span><br><span class=\"line\">we reject null hypothesis</span><br></pre></td></tr></table></figure>","categories":[{"name":"Python","slug":"Python","count":4,"path":"api/categories/Python.json"}],"tags":[{"name":"Python","slug":"Python","count":4,"path":"api/tags/Python.json"}]}